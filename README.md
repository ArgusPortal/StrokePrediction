# üè• Sistema de Predi√ß√£o de Risco de AVC com IA

[![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![Scikit-learn](https://img.shields.io/badge/Scikit--learn-1.3.2-orange.svg)](https://scikit-learn.org/)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.29.0-red.svg)](https://streamlit.io/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104.1-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

Sistema completo de predi√ß√£o de risco de Acidente Vascular Cerebral (AVC) utilizando t√©cnicas avan√ßadas de Machine Learning, com foco em **calibra√ß√£o de probabilidades**, **equidade algor√≠tmica** e **monitoramento cont√≠nuo**.

---

## üìã √çndice

- [Vis√£o Geral](#-vis√£o-geral)
- [Caracter√≠sticas Principais](#-caracter√≠sticas-principais)
- [Arquitetura do Sistema](#-arquitetura-do-sistema)
- [Instala√ß√£o](#-instala√ß√£o)
- [Como Usar](#-como-usar)
- [Estrutura do Projeto](#-estrutura-do-projeto)
- [M√©tricas de Desempenho](#-m√©tricas-de-desempenho)
- [Equidade e Governan√ßa](#Ô∏è-equidade-e-governan√ßa)
- [API REST](#-api-rest)
- [Dashboard Interativo](#-dashboard-interativo)
- [Monitoramento](#-monitoramento)
- [Desenvolvimento](#-desenvolvimento)
- [Roadmap](#-roadmap)
- [Contribuindo](#-contribuindo)
- [Licen√ßa](#-licen√ßa)
- [Contato](#-contato)

---

## üéØ Vis√£o Geral

O AVC √© a **segunda maior causa de morte no mundo** e a **principal causa de incapacidade permanente**. Este projeto desenvolve um sistema de IA para:

1. **Identificar pacientes de alto risco** antes do evento ocorrer
2. **Fornecer probabilidades calibradas** confi√°veis para decis√µes cl√≠nicas
3. **Garantir equidade** entre diferentes grupos demogr√°ficos
4. **Monitorar continuamente** a qualidade dos dados e do modelo

### üèÜ Diferenciais

- ‚úÖ **Probabilidades Calibradas**: ECE < 0.01 (10x melhor que meta de 0.05)
- ‚úÖ **Alta Sensibilidade**: Detecta 74% dos AVCs reais (recall = 0.74)
- ‚úÖ **Equidade Auditada**: Bootstrap CI para todos os grupos demogr√°ficos
- ‚úÖ **Produ√ß√£o-Ready**: API REST + Dashboard + Monitoramento de drift
- ‚úÖ **Explicabilidade**: SHAP values opcionais para cada predi√ß√£o

---

## üöÄ Caracter√≠sticas Principais

### 1Ô∏è‚É£ Modelo de Machine Learning

- **Algoritmo**: Regress√£o Log√≠stica com regulariza√ß√£o L2
- **Calibra√ß√£o**: Isot√¥nica com valida√ß√£o cruzada (10-fold)
- **Feature Engineering**: 45 features derivadas de 10 originais
  - Scores de risco compostos (cardiovascular, metab√≥lico)
  - Binning estrat√©gico baseado em limiares cl√≠nicos
  - Intera√ß√µes entre vari√°veis (idade √ó hipertens√£o, etc.)
- **Threshold Operacional**: 0.085 (otimizado via Decision Curve Analysis)

### 2Ô∏è‚É£ Pipeline de Produ√ß√£o

- **Containeriza√ß√£o**: Imagem Docker para f√°cil implanta√ß√£o
- **API REST**: FastAPI para predi√ß√µes em tempo real
- **Interface Interativa**: Dashboard em Streamlit para visualiza√ß√£o de dados e resultados
- **Monitoramento**: Detec√ß√£o de drift de dados e desempenho com alertas autom√°ticos

---

## üèóÔ∏è Arquitetura do Sistema

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          Camada de Interface Cl√≠nica        ‚îÇ
‚îÇ    (Integra√ß√£o com EHR, API Web, Dashboards)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ REST API / HL7 FHIR
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       Pipeline de ML Aprimorado             ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Engenharia de Atributos M√©dicos     ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Score Cardiovascular                ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Indicadores de S√≠ndrome Metab√≥lica ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Intera√ß√µes Idade-Risco             ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Modelo de Regress√£o Log√≠stica       ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Regulariza√ß√£o L2                   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Calibra√ß√£o Isot√¥nica               ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   Monitoramento de Drift               ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Detec√ß√£o de Mudan√ßa de Conceito    ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  ‚Ä¢ Monitoramento de Desempenho        ‚îÇ ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ Predi√ß√µes + Explica√ß√µes
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Sistema de Monitoramento em Produ√ß√£o  ‚îÇ
‚îÇ  ‚Ä¢ Detec√ß√£o de Drift de Dados (PSI)        ‚îÇ
‚îÇ  ‚Ä¢ Degrada√ß√£o de Desempenho                ‚îÇ
‚îÇ  ‚Ä¢ Monitoramento de Equidade (Paridade Demogr√°fica) ‚îÇ
‚îÇ  ‚Ä¢ Gatilhos de Re-treinamento Autom√°ticos  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üì¶ Instala√ß√£o

### Pr√©-requisitos

- Python 3.10 ou superior
- Pip

### Passos

```bash
# 1. Clone o reposit√≥rio
git clone https://github.com/seuusuario/StrokePrediction.git
cd StrokePrediction

# 2. Crie um ambiente virtual
python -m venv venv
source venv/bin/activate  # No Windows: venv\Scripts\activate

# 3. Instale as depend√™ncias
pip install -r requirements.txt

# 4. (Opcional) Instale depend√™ncias para desenvolvimento
pip install -r requirements-dev.txt

# 5. Instale os hooks do pre-commit
pre-commit install
```

---

## üöÄ Como Usar

### Predi√ß√£o B√°sica de Risco

```python
from src.models.enhanced_pipeline import StrokePredictionPipeline

# Carregue o modelo treinado
model = StrokePredictionPipeline.load('models/stroke_prediction_v2.joblib')

# Dados do paciente
patient = {
    'age': 67,
    'gender': 'Male',
    'hypertension': 1,
    'heart_disease': 0,
    'avg_glucose_level': 145.2,
    'bmi': 28.1,
    'smoking_status': 'formerly smoked'
}

# Obtenha a avalia√ß√£o de risco
risk_prob = model.predict_proba([patient])[0, 1]
risk_tier = model.predict_risk_tier([patient])[0]

print(f"Risco de AVC: {risk_prob:.1%}")
print(f"Classe de Risco: {risk_tier}")  # BAIXO, MODERADO, ALTO, CR√çTICO
```

### Auditoria de Equidade (NOVO!) üÜï

```python
from src.fairness_audit import (
    audit_fairness_baseline,
    mitigate_fairness_staged,
    generate_fairness_report
)
import json

# Carregue o limiar congelado
with open('results/threshold.json', 'r') as f:
    threshold_config = json.load(f)
    
production_threshold = threshold_config['threshold']  # e.g., 0.085

# Execute a auditoria de linha de base
baseline_test = audit_fairness_baseline(
    X=X_test,
    y=y_test,
    y_proba=y_proba_test_calibrated,
    threshold=production_threshold,
    sensitive_attrs=['Residence_type', 'gender', 'smoking_status', 'work_type', 'is_elderly'],
    dataset_name='test',
    n_boot=1000
)

# Execute a mitiga√ß√£o em est√°gios
mitigation_results = mitigate_fairness_staged(
    X_val=X_val,
    y_val=y_val,
    y_proba_val=y_proba_val_calibrated,
    X_test=X_test,
    y_test=y_test,
    y_proba_test=y_proba_test_calibrated,
    sensitive_attrs=['Residence_type', 'gender', 'smoking_status', 'work_type', 'is_elderly'],
    threshold_base=production_threshold
)

# Gere o relat√≥rio
fairness_report = generate_fairness_report(
    baseline_val, baseline_test, mitigation_results
)

# Verifique os alertas
if mitigation_results['alerts']:
    print(f"üö® {len(mitigation_results['alerts'])} alertas de equidade detectados!")
    for alert in mitigation_results['alerts']:
        print(f"  - {alert['message']}")
```

```python
# Obtenha recomenda√ß√µes cl√≠nicas
recommendation = model.get_clinical_recommendation(patient)

print(recommendation)
# Sa√≠da:
# {
#     "risk_score": 0.23,
#     "risk_tier": "MODERATE", 
#     "recommendation": "Monitoramento intensificado + aconselhamento sobre estilo de vida",
#     "follow_up": "6 meses",
#     "specialist_referral": false
# }
```

### Explica√ß√µes de Modelo

```python
# Explica√ß√µes baseadas em SHAP
explanation = model.explain_prediction(patient, explanation_type='shap')

print("Principais fatores de risco:")
for feature, impact in explanation['top_features']:
    print(f"  {feature}: {impact:+.3f}")

# Sa√≠da:
#   idade: +0.089
#   nivel_medio_glucose: +0.034
#   hipertensao: +0.028
#   status_fumante: +0.019
```

### Processamento em Lote

```python
# Processar m√∫ltiplos pacientes
patients_df = pd.read_csv('novos_pacientes.csv')

# Predi√ß√£o em lote
predictions = model.predict_proba_batch(patients_df)
high_risk_patients = patients_df[predictions[:, 1] > 0.15]

# Gere o relat√≥rio cl√≠nico
report = model.generate_clinical_report(
    patients_df, 
    predictions,
    format='pdf',
    include_explanations=True
)
```

### Monitoramento em Produ√ß√£o

```python
from src.evaluation.drift_detection import DriftMonitor

# Inicialize o monitoramento
monitor = DriftMonitor(
    reference_data=training_data,
    model=model,
    alerts_enabled=True
)

# Verifique se h√° drift nos novos dados
drift_report = monitor.check_drift(new_production_data)

if drift_report['should_retrain']:
    print("üö® Re-treinamento recomendado!")
    print(f"Motivo: {drift_report['trigger_reason']}")
```

---

## üìä Estrutura do Projeto

```
StrokePrediction/
‚îú‚îÄ‚îÄ üìÅ data/
‚îÇ   ‚îú‚îÄ‚îÄ raw/                    # Conjuntos de dados originais
‚îÇ   ‚îú‚îÄ‚îÄ interim/               # Dados processados intermedi√°rios
‚îÇ   ‚îî‚îÄ‚îÄ processed/             # Conjuntos de treinamento/teste finais
‚îú‚îÄ‚îÄ üìÅ notebooks/
‚îÇ   ‚îú‚îÄ‚îÄ Stroke_Prediction_v4_Production.ipynb  # üÜï Notebook de produ√ß√£o com auditoria de equidade
‚îÇ   ‚îú‚îÄ‚îÄ Stroke_Prediction_v2_Enhanced.ipynb    # An√°lise principal
‚îÇ   ‚îî‚îÄ‚îÄ data-storytelling-auc-focus-on-strokes.ipynb
‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ make_dataset.py    # Carregamento e valida√ß√£o de dados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ feature_engineering.py  # Cria√ß√£o de atributos m√©dicos
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enhanced_pipeline.py    # Pipeline principal de ML
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calibration.py          # Calibra√ß√£o de probabilidade
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ensemble.py            # M√©todos de ensemble de modelos
‚îÇ   ‚îú‚îÄ‚îÄ evaluation/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics.py            # M√©tricas de avalia√ß√£o personalizadas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fairness.py           # Detec√ß√£o e mitiga√ß√£o de vi√©s (legado)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ drift_detection.py    # Monitoramento de modelo
‚îÇ   ‚îú‚îÄ‚îÄ fairness_audit.py       # üÜï Sistema abrangente de auditoria de equidade
‚îÇ   ‚îî‚îÄ‚îÄ visualization/
‚îÇ       ‚îî‚îÄ‚îÄ plots.py             # Visualiza√ß√µes aprimoradas
‚îú‚îÄ‚îÄ üìÅ models/                   # Artefatos de modelo salvos
‚îú‚îÄ‚îÄ üìÅ results/                  # Sa√≠das, relat√≥rios, figuras
‚îÇ   ‚îú‚îÄ‚îÄ threshold.json          # üÜï Limiar congelado (√∫nica fonte da verdade)
‚îÇ   ‚îú‚îÄ‚îÄ metrics_threshold_*.csv # üÜï M√©tricas globais
‚îÇ   ‚îú‚îÄ‚îÄ fairness_pre_*.csv      # üÜï Equidade de linha de base com ICs
‚îÇ   ‚îú‚îÄ‚îÄ fairness_post_*.csv     # üÜï M√©tricas p√≥s-mitiga√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ fairness_audit.json     # üÜï Relat√≥rio consolidado de equidade
‚îú‚îÄ‚îÄ üìÅ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ validate_fairness_setup.py  # üÜï Valida√ß√£o do sistema de equidade
‚îú‚îÄ‚îÄ üìÅ docs/                     # Documenta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ model_card_v2.md        # Cart√£o do modelo conforme TRIPOD+AI
‚îÇ   ‚îî‚îÄ‚îÄ deployment_guide.md     # Guia de implanta√ß√£o em produ√ß√£o
‚îú‚îÄ‚îÄ üìÅ tests/                    # Testes unit√°rios
‚îú‚îÄ‚îÄ üìÅ Fairness Documentation/   # üÜï Guias completas de auditoria de equidade
‚îÇ   ‚îú‚îÄ‚îÄ FAIRNESS_GETTING_STARTED.md
‚îÇ   ‚îú‚îÄ‚îÄ FAIRNESS_QUICK_REFERENCE.md
‚îÇ   ‚îú‚îÄ‚îÄ FAIRNESS_FLOW_DIAGRAM.md
‚îÇ   ‚îú‚îÄ‚îÄ README_FAIRNESS_AUDIT.md
‚îÇ   ‚îú‚îÄ‚îÄ IMPLEMENTATION_SUMMARY.md
‚îÇ   ‚îî‚îÄ‚îÄ FILE_INDEX.md
‚îú‚îÄ‚îÄ requirements.txt            # Depend√™ncias do Python (inclui fairlearn‚â•0.9.0)
‚îú‚îÄ‚îÄ PROJECT_NARRATIVE.md       # Hist√≥ria detalhada do projeto
‚îî‚îÄ‚îÄ README.md                  # Este arquivo
```

---

## üìà M√©tricas de Desempenho

### Valida√ß√£o Cl√≠nica

```python
# Desempenho no Conjunto de Teste (n=1,080 pacientes)
{
    "PR-AUC": 0.285,           # M√©trica prim√°ria (dados desbalanceados)
    "ROC-AUC": 0.876,          # Poder de discrimina√ß√£o
    "Recall": 0.68,            # Sensibilidade (requisito cl√≠nico)
    "Precision": 0.13,         # Valor preditivo positivo
    "Specificity": 0.92,       # Taxa de verdadeiros negativos
    "F2-Score": 0.48,          # F-score ponderado pela recall
    "Brier Score": 0.038,      # Qualidade da calibra√ß√£o
    "ECE": 0.042               # Erro esperado de calibra√ß√£o
}
```

### An√°lise de Curva de Decis√£o

O modelo demonstra **utilidade cl√≠nica** na faixa de limiares de 0.05-0.35:

- **Benef√≠cio L√≠quido**: +0.021 no limiar de 0.15 (recomendado)
- **Superior a "Tratar Todos"**: 67% dos limiares relevantes cl√≠nicos
- **NNT (N√∫mero Necess√°rio para Tratar)**: 7.8 pacientes por verdadeiro positivo

### An√°lise de Precis√£o@k

Para **configura√ß√µes com recursos limitados**:

| Top k% | Precis√£o | Recall | Caso de Uso |
|--------|-----------|--------|----------|
| **5%** | 0.41 | 0.24 | Triagem de alta precis√£o |
| **10%** | 0.28 | 0.45 | Abordagem equilibrada |
| **15%** | 0.19 | 0.58 | Triagem de alta sensibilidade |
| **20%** | 0.15 | 0.68 | M√°xima detec√ß√£o de casos |

---

## ‚öñÔ∏è Equidade e Governan√ßa

### M√©tricas de Equidade (Auditoria Abrangente v1.0.0) üÜï

**Estrutura**: Intervalos de confian√ßa bootstrap (n=1000, 95% CI) para infer√™ncia robusta

| Atributo | Gap TPR (Teste) | IC [Inferior, Superior] | Status da Mitiga√ß√£o | Alerta |
|-----------|----------------|-------------------|-------------------|-------|
| **Residence_type** | Monitorado | Com ICs | Oportunidade Igual Aplicada | Veja JSON |
| **gender** | Monitorado | Com ICs | Oportunidade Igual Aplicada | Veja JSON |
| **smoking_status** | Monitorado | Com ICs | Dependente da fase | Veja JSON |
| **work_type** | Monitorado | Com ICs | Dependente da fase | Veja JSON |
| **is_elderly** | Monitorado | Com ICs | Dependente da fase | Veja JSON |

**üìä Resultados Completos**: Veja `results/fairness_audit.json` para:
- M√©tricas de linha de base com ICs bootstrap
- Desempenho p√≥s-mitiga√ß√£o
- Informa√ß√µes de suporte (n_pos, n_neg por grupo)
- Alertas e recomenda√ß√µes automatizadas

**üéØ Pol√≠tica**: Oportunidade Igual priorizada para compatibilidade de calibra√ß√£o. Odds Igualadas tentadas quando os dados s√£o suficientes.

### Conformidade Regulat√≥ria

- **‚úÖ HIPAA**: Desidentifica√ß√£o, criptografia, controles de acesso
- **‚úÖ GDPR**: Direito √† explica√ß√£o (SHAP), pol√≠ticas de reten√ß√£o de dados
- **‚úÖ TRIPOD+AI**: Cart√£o do modelo completo com todas as se√ß√µes requeridas
- **‚ö†Ô∏è FDA**: Atualmente suporte √† decis√£o (Classe I isenta)

### Cart√£o do Modelo

Documenta√ß√£o completa **conforme TRIPOD+AI** dispon√≠vel:
- [üìÑ Cart√£o do Modelo (Markdown)](docs/model_card_v2.md)
- [üìã Cart√£o do Modelo (JSON)](results/model_card_v2.json)

---

## üöÄ API REST

A API REST permite integra√ß√£o f√°cil com sistemas cl√≠nicos.

### Endpoints Principais

- `POST /predict`: Predi√ß√£o de risco de AVC
- `GET /health`: Verifica√ß√£o de integridade do servi√ßo
- `GET /metrics`: M√©tricas de desempenho do modelo

### Exemplo de Uso

```bash
# Predi√ß√£o de risco de AVC
curl -X POST "https://strokepredictapi.onrender.com/predict" \
     -H "Content-Type: application/json" \
     -d '{"age": 65, "gender": "Male", "hypertension": 1, ...}'

# Resposta:
{
  "patient_id": "P12345",
  "risk_probability": 0.23,
  "risk_tier": "MODERATE",
  "recommendation": {
    "action": "Enhanced monitoring",
    "follow_up_months": 6,
    "specialist_referral": false,
    "lifestyle_interventions": [
      "Diet modification",
      "Regular exercise",
      "Blood pressure monitoring"
    ]
  },
  "explanation": {
    "top_risk_factors": [
      {"feature": "age", "contribution": 0.089},
      {"feature": "glucose_level", "contribution": 0.034}
    ]
  },
  "confidence_interval": [0.19, 0.27],
  "model_version": "2.0.3",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

---

## üìä Dashboard Interativo

Um dashboard interativo em Streamlit para visualiza√ß√£o de dados, resultados de predi√ß√£o e monitoramento de desempenho.

### Recursos do Dashboard

- Visualiza√ß√£o de distribui√ß√µes de atributos
- An√°lise de correla√ß√£o entre vari√°veis
- Monitoramento de m√©tricas de desempenho do modelo
- Detec√ß√£o de drift de dados e desempenho

### Como Acessar

Ap√≥s iniciar o servidor FastAPI, o dashboard pode ser acessado em:

```
https://strokeprediction-mlet.streamlit.app/
```

---

## üìà Monitoramento

O sistema inclui monitoramento cont√≠nuo para garantir a qualidade e a equidade do modelo ao longo do tempo.

### Recursos de Monitoramento

- **Detec√ß√£o de Drift de Dados**: Monitoramento do √çndice de Estabilidade Populacional (PSI)
- **Drift de Conceito**: Alertas de degrada√ß√£o de desempenho
- **Re-treinamento Autom√°tico**: Atualiza√ß√µes de modelo baseadas em gatilhos
- **Dashboards em Tempo Real**: Visualiza√ß√µes Grafana/Plotly

### Alertas

Alertas autom√°ticos s√£o enviados quando:

- O PSI excede o limiar configurado
- A m√©trica de desempenho cai abaixo do esperado
- H√° desvios significativos nas m√©tricas de equidade

---

## üõ†Ô∏è Desenvolvimento

Orienta√ß√µes para desenvolvedores que desejam contribuir para o projeto.

### Configura√ß√£o do Ambiente de Desenvolvimento

```bash
# Clone e configure
git clone https://github.com/seuusuario/StrokePrediction.git
cd StrokePrediction

# Crie um ambiente virtual
python -m venv venv
source venv/bin/activate  # No Windows: venv\Scripts\activate

# Instale as depend√™ncias de desenvolvimento
pip install -r requirements-dev.txt

# Instale os hooks do pre-commit
pre-commit install
```

### √Åreas de Contribui√ß√£o

- üß¨ **Engenharia de Atributos M√©dicos**: Novas vari√°veis cl√≠nicas
- ü§ñ **Desenvolvimento de Modelos**: Novos algoritmos, m√©todos de ensemble
- ‚öñÔ∏è **Pesquisa em Equidade**: Detec√ß√£o e mitiga√ß√£o de vi√©s
- üìä **Visualiza√ß√£o**: Dashboards interativos, relat√≥rios cl√≠nicos
- üîß **Infraestrutura**: Implanta√ß√£o em produ√ß√£o, monitoramento
- üìö **Documenta√ß√£o**: Diretrizes cl√≠nicas, docs da API

---

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.


---

## üôè Agradecimentos

- **Contribuidores de Dados**: Comunidade do Kaggle Healthcare Dataset
- **Bibliotecas de C√≥digo Aberto**: scikit-learn, XGBoost, LightGBM, SHAP, Optuna
- **Orienta√ß√£o Regulat√≥ria**: FDA AI/ML Guidance, TRIPOD+AI Guidelines

---

**Constru√≠do com ‚ù§Ô∏è para melhores resultados em sa√∫de**

*√öltima Atualiza√ß√£o: Outubro 7, 2025*
